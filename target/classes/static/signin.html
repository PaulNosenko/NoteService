<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cloud Note</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<style>
i {
    border: solid black;
    border-width: 0 7px 7px 0;
    display: inline-block;
    padding: 5px;
}
.down {
    transform: rotate(45deg);
    -webkit-transform: rotate(45deg);
}
.up {
    transform: rotate(-135deg);
    -webkit-transform: rotate(-135deg);
}
</style>

</head>
<body>

<div id="signindiv">
    <section class="hero is-fullheight">
        <div class="hero-body">
            <div class="container has-text-centered">
                <div class="column is-4 is-offset-4">
                    <h3 class="title">Login</h3>
                    <p class="subtitle">Please login to proceed.</p>
                    <div class="box">
                        
                        <form>
                            <div class="field">
                                <div class="control">
                                    <input class="input is-large" type="email" placeholder="Your Email" autofocus="" id="email">
                                </div>
                            </div>

                            <div class="field">
                                <div class="control">
                                    <input class="input is-large" type="password" placeholder="Your Password" id="password">
                                </div>
                            </div>
                            <a class="button is-block is-info is-large" id="submit">Login</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>


<div id="operationdiv" style="margin: 40px">

    <a id="signout" class="button is-info is-outlined" style="float: right">Sign out</a>
    <h2 class="title"><b>You're logged in!</b></h2>


    <div class="box has-text-centered">

        <h3 class="subtitle"><b>My Notes</b></h3>

		
        <table class="table is-striped" style="margin: 0px auto;">
            <thead>
                <tr>
                    <th>ID</th>
                    <td>DESCRIPTION</td>
                    <td>PRIORITY</td>
                    <td>DATE</td>
                    <td>DELETE</td>
                    <td>Search</td>
                </tr>
            </thead>
            <tbody id="bodyTableNotes">
                <tr>
                    <th>1</th>
                    <td>First Description</td>
                    <td>high</td>
                    <td>12/03/2017</td>
                    <td><a class="delete"></a></td>
                    <td><a class="search"></a></td>
                </tr>
                <tr>
                    <th>2</th>
                    <td>Second Description</td>
                    <td>low</td>
                    <td>11/03/2017</td>
                    <td><a class="delete"></a></td>
                    <td><a class="search"></a></td>
                </tr>
                <tr>
                    <th>3</th>
                    <td>Third Description</td>
                    <td>low</td>
                    <td>10/03/2017</td>
                    <td><a class="delete"></a></td>
                    <td><a class="search"></a></td>
                </tr>
            </tbody>
        </table>
        <br /><br />

		
		
		<div class="tip1" style="height: 120px; width: 190px; background: #00d1b2;  margin-bottom: 50px; margin-left: 250px; ">
			<p style="padding-top: 15px; color: white;">In order to add new note type in the description </p>
			<button class="nextBtn1" style="padding: 0 15px; border: none; background: white; font-size: 17px; color: #00d1b2;">Next Tip</button>
			<p><i class="arrow down"></i></p>
		</div>
		
		
		<div class="tip2" style="height: 120px; width: 190px; background: #00d1b2;  margin-bottom: 50px; margin-left: 10px;">
			<p style="padding-top: 15px; color: white;">In order to add priority to your note press the button below </p>
			<button class="nextBtn2" style="padding: 0 15px; border: none; background: white; font-size: 17px; color: #00d1b2;">Next Tip</button>
			<p><i class="arrow down"></i></p>
		</div>
		
		
		<div class="tip4" style="height: 100px; width: 190px; background: #00d1b2; margin-bottom: 50px; margin-left: 741px;">
			<p><i class="arrow up" style="padding-bottom: 5px;"></i></p>
			<p style="color: white;">To delete a note press button above</p>
			<button class="nextBtn4" style="padding: 0 15px; border: none; background: white; font-size: 17px; color: #00d1b2;">Next Tip</button>
		</div>
		
		
		<div class="tip5" style="height: 100px; width: 190px; background: #00d1b2; margin-bottom: 50px; margin-left: 821px;">
			<p><i class="arrow up" style="padding-bottom: 5px;"></i></p>
			<p style="color: white;">To search in browser supporting information</p>
			<button class="nextBtn5" style="padding: 0 15px; border: none; background: white; font-size: 17px; color: #00d1b2;">Got it !</button>
		</div>
		
		

        <div class="field has-addons">
            <p class="control">
               <span class="select">
                  <select id="newNotePriority">
                    <option name="priority" value="" disabled selected>Priority</option>
                    <option value="high">high</option>
                    <option value="low">low</option>
                  </select>
               </span>
            </p>
            <p class="control is-expanded">
                <input class="input" id="newNoteDescription" type="text" placeholder="Description of note"/>
            </p>
                <input type="hidden" id="newNoteEmail" value=""/>
            <p class="control">
                <a class="button is-primary" id="newNote">
                    New Note
                </a>
            </p>
        </div>

    </div>

</div>

<script>
    $(document).ready(function(){
       $("#signindiv").show();         
       $("#operationdiv").hide();
       $(".tip1").hide();
       $(".tip2").hide();
	 
	   $(".tip4").hide();
	   $(".tip5").hide();
     });
    
    
    
    $(".nextBtn1").click(function(){
        $(".tip1").hide()
		$(".tip2").fadeIn(3000);
    });
	
	$(".nextBtn2").click(function(){
        $(".tip2").hide()
		$(".tip4").fadeIn(3000);
    });
	
	$(".nextBtn4").click(function(){
        $(".tip4").hide()
		$(".tip5").fadeIn(3000);
    });
	
	$(".nextBtn5").click(function(){
        $(".tip5").fadeOut(1000)
    });
    
    function getCookie(name) {
       var value = "; " + document.cookie;
       var parts = value.split("; " + name + "=");
       if (parts.length == 2)
          return parts.pop().split(";").shift();
    }
    
    function changeUrl(title, url) {
       if (typeof (history.pushState) != "undefined") {
          var obj = { Title: title, Url: url };
          history.pushState(obj, obj.Title, obj.Url);
       } else {
          alert("Browser does not support HTML5.");
       }
    }
    
    function showNotes() {
       
       $.ajax({                                                                        
           url: 'http://localhost:8080/showNotes',
           type: "POST",
           success: function (data, status, xhr) {
              console.log(data);
              $("#bodyTableNotes").empty();
              jQuery.each(data.response, function(i, val) {
                 $("#bodyTableNotes").append("<tr><th>" + val.id + "</th><td>" + val.description + "</td><td>" + val.priority + "</td><td>" + convertDate(val.date) + "</td><td><p class='delete' onclick='deleteNote(" + val.id + ")'></p></td>   <td><button onclick='search(\""+ val.description + "\")'>Search</button></td>   </tr>");
              });
           },
           error: function(result) {
              alert("Error show to dos!");
              console.log(result);
           }
       });
      
       
    }
    
   
    
    function deleteNote(id) {
     
       $.ajax({
          url: 'http://localhost:8080/deleteNote/' + id,
          type: "POST",
          success: function (data, status, xhr) {
             console.log(data);
            
             showNotes();
          },
          error: function(result) {
             alert("Error!");
             console.log(result);
          }
       });
    }
    function convertDate(inputFormat) {
        function pad(s) { return (s < 10) ? '0' + s : s; }
        var d = new Date(inputFormat);
        return [pad(d.getDate()), pad(d.getMonth()+1), d.getFullYear()].join('/');
    }
    
    $("#submit").click(function(e) {
       e.preventDefault();
       $.ajax({                                                        
          url: 'http://localhost:8080/login',
          type: "POST",
          data: {
             email: $("#email").val(),
             password: $("#password").val()
          },
          success: function (data, status, xhr) {
             $("#signindiv").hide();                           
             $("#operationdiv").show();
             
             
             $(".tip1").fadeIn(3000);
             
             
             changeUrl("Notes","/notes.html");               
             document.cookie = "jwt=" + xhr.getResponseHeader("jwt");  
             $("#newNoteEmail").val($("#email").val());
             $("#password").val("");
             showNotes();
          },
          error: function(result) {
             alert("Sign in failed!");
             console.log(result);
          }
       });
    });
   
    $("#signout").click(function(e) {
       e.preventDefault();
       document.cookie = "jwt=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";       
       $("#signindiv").show();                                            
       $("#operationdiv").hide();
       $("#email").val("");
       emptyForm();
       $("#newNoteEmail").val("");
       alert("You're logged out!");
       changeUrl("Signin","/signin.html");                                    
    });
    $("#newNote").click(function(e) {
       e.preventDefault();
       if( $("#newNotePriority").val() == null ){
           alert("Insert a valid priority value");
       } else if ($("#newNoteDescription").val() == ""){
           alert("Insert a valid description value");
       }else{
           
           $.ajax({                                                       
              url: 'http://localhost:8080/newNote',
              type: "POST",
              data: {
                 description: $("#newNoteDescription").val(),
                 priority: $("#newNotePriority").val(),
                 fkUser: $("#newNoteEmail").val()
              },
              success: function (data, status, xhr) {
                 emptyForm();
                 showNotes();
              },
              error: function(result) {
                 alert("Error! add");
                 console.log(result);
              }
           });
       }
    });
    function emptyForm() {
       $("#newNoteDescription").val("");
       $("#newNotePriority").val('');
    }
</script>
<script type="text/javascript" charset="utf-8">
function search(query) {
    url ='http://www.google.com/search?q=' + query;
    window.open(url,'_blank');
}
function sortTable(){
	  var rows = $('#bodyTableNotes tbody  tr').get();

	  rows.sort(function(a, b) {

	  var A = $(a).children('td').eq(1).text().toUpperCase();
	  var B = $(b).children('td').eq(1).text().toUpperCase();

	  if(A < B) {
	    return -1;
	  }

	  if(A > B) {
	    return 1;
	  }

	  return 0;

	  });

	  $.each(rows, function(index, row) {
	    $('#bodyTableNotes').children('tbody').append(row);
	  });
	}
</script>
</body>
</html>